
<!DOCTYPE html>
<html lang="en">
        <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=Edge"/>

        <title>Ian Bebbington - Ignoring a Billion-Dollar Mistake is simply not an Option</title>
        <meta name="description" content="IObservable&lt;Opinion&gt;" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0">        

        <link type="application/rss+xml" rel="alternate" title="Ian Bebbington" href="/feed.rss" />
                <link type="application/atom+xml" rel="alternate" title="Ian Bebbington" href="/feed.atom" />
        <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
        <link rel="icon" href="/favicon.ico" type="image/x-icon">

        <link href="/assets/css/bootstrap.min.css" rel="stylesheet" />
        <link href="/assets/css/highlight.css" rel="stylesheet">
        <link href="/assets/css/clean-blog.css" rel="stylesheet" />
        <link href="/assets/css/master.css" rel="stylesheet" />
        <link href="/assets/css/font-awesome.min.css" rel="stylesheet" type="text/css">
        <link href='//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
        <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>
        <link href="/assets/css/override.css" rel="stylesheet" />


        <meta name="application-name" content="Ian Bebbington" />
        <meta name="msapplication-tooltip" content="Ian Bebbington" />
        <meta name="msapplication-starturl" content="/" />

        <meta property="og:title" content="Ian Bebbington - Ignoring a Billion-Dollar Mistake is simply not an Option" />
        <meta property="og:type" content="website" />
        <meta property="og:url" content="http://ian.bebbs.co.uk/posts/IgnoringABillionDollarMistakeIsNotAnOption" />
        <!-- TODO: More social graph meta tags -->

        <script src="/assets/js/jquery.min.js"></script>
        <script src="/assets/js/bootstrap.min.js"></script>     
        <script src="/assets/js/highlight.pack.js"></script>   
        <script src="/assets/js/clean-blog.js"></script>
        <script src="/assets/js/d3.v3.min.js"></script>
        <script src="/assets/js/trianglify.min.js"></script>
        <script src="/assets/js/Please-compressed.js"></script>
        <script src="/assets/js/background-check.min.js"></script>
                
        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
                <script src="/assets/js/html5shiv.js"></script>
                <script src="/assets/js/respond.min.js"></script>
        <![endif]-->
        
        <link href="https://cdnjs.cloudflare.com/ajax/libs/ekko-lightbox/5.3.0/ekko-lightbox.css" rel="stylesheet">
<link href="/assets/css/ekko-override.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/ekko-lightbox/5.3.0/ekko-lightbox.min.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-70151903-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-70151903-1');
</script>


        </head>
        <body>
                
                <!-- Navigation -->
                <nav class="navbar navbar-default navbar-custom navbar-fixed-top">
                        <div class="container-fluid">
                                <!-- Brand and toggle get grouped for better mobile display -->
                                <div class="navbar-header page-scroll">
                                        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse">
                                        <span class="sr-only">Toggle navigation</span>
                                        <span class="icon-bar"></span>
                                        <span class="icon-bar"></span>
                                        <span class="icon-bar"></span>
                                        </button>
                                        <a class="navbar-brand" href="/">Ian Bebbington</a>
                                </div>
                        
                                <!-- Collect the nav links, forms, and other content for toggling -->
                                <div class="collapse navbar-collapse" id="navbar-collapse">
                                        <ul class="nav navbar-nav navbar-right">
                                                        <li><a href="/posts">Archive</a></li>
        <li><a href="/tags">Tags</a></li>
        <li><a href="/about">About</a></li>
 
                                        </ul>
                                </div>
                                <!-- /.navbar-collapse -->
                        </div>
                        <!-- /.container -->
                </nav>
                
                <!-- Page Header -->
                <header class="intro-header" id="intro-header">
                        <div class="container">
                                <div class="row">
                                        <div class="col-md-12">

    
<div class="post-heading">
    <h1>Ignoring a Billion-Dollar Mistake is simply not an Option</h1>
        <h2 class="subheading">But are nullable reference types the answer?</h2>
    <div class="meta">        
Published on 06 June 2019<br>    </div>
        <div class="tags">
                    <a role="button" href="/tags/C%23" class="btn btn-default btn-xs">C#</a>
                    <a role="button" href="/tags/Declarative" class="btn btn-default btn-xs">Declarative</a>
                    <a role="button" href="/tags/Methodology" class="btn btn-default btn-xs">Methodology</a>
                    <a role="button" href="/tags/Patterns" class="btn btn-default btn-xs">Patterns</a>
        </div>     
</div>
                                        </div>
                                </div>
                        </div>
                </header>
                
                <!-- Main Content -->
                <div class="container">
                        <div class="row">
                                <div id="content" class="col-md-12">
                                        

<h2 id="a-billion-dollar-mistake">A 'Billion-Dollar Mistake'?</h2>
<p>In 1965, computer scientist and otherwise all round good egg, Sir Charles Antony Richard Hoare (Tony to most) unleashed the 'null reference' upon an unsuspecting world, simply because it was &quot;so easy&quot;. Five decades later, the vast majority of computer programmers remain all too au fait with the &quot;null reference&quot; exception, battling it's seemingly unstoppable encroachment into otherwise flawless program flows.</p>
<p>In 2009, Tony apologised for inventing the null reference, stating:</p>
<blockquote class="blockquote">
<p>I call it my billion-dollar mistake. It was the invention of the null reference in 1965. At that time, I was designing the first comprehensive type system for references in an object oriented language (ALGOL W). My goal was to ensure that all use of references should be absolutely safe, with checking performed automatically by the compiler. But I couldn't resist the temptation to put in a null reference, simply because it was so easy to implement. This has led to innumerable errors, vulnerabilities, and system crashes, which have probably caused a billion dollars of pain and damage in the last forty years.</p>
</blockquote>
<p>&quot;Innumerable errors, vulnerabilities, and system crashes&quot;? How so? Well, in most programming languages, null is not just a valid value for a reference type, it is the <em>default</em> value. This means that any uninitialized reference type variable will cause a null reference exception if it is dereferenced. Furthermore, because null is the default reference type value, it tends to be the value returned when a process cannot be completed/calculated correctly causing otherwise innocuous dependent code to become inherently error prone. For example:</p>
<pre><code class="language-c#">string value = ParseValue(); // &lt;= returns null as value cannot be parsed
Console.WriteLine($&quot;Value contains {value.Length} characters&quot;); // &lt;= Boom!
</code></pre>
<p>Yes, we all look at the above code and shrug it off with a &quot;D'uh, of course the value should be null checked&quot;. But why? Why, in a statically typed and run-time checked language should there exist such a simple - and indeed default - means of causing an exception when, by definition, <a href="https://www.google.com/search?q=exceptions+should+be+exceptional">exceptions should be exceptional</a>.</p>
<h2 id="c-8.0-to-the-rescue">C# 8.0 to the rescue?</h2>
<p>With the rise in prominence of functional languages (particularly F#) which do not suffer this issue (at least by default), the C# community is working to address this mistake with the release of a major new feature in version 8.0 of the language: <a href="https://docs.microsoft.com/en-us/dotnet/csharp/nullable-references">Nullable reference types</a>.</p>
<p>Firstly, kudos to the community for calling the feature &quot;Nullable reference types&quot; rather than &quot;Non-nullable reference types&quot; inferring that nullability is the &quot;non-default behaviour&quot; you can have if you explicitly want. Unfortunately, the implementation of this feature is, in my opinion, completely hamstrung by backwards compatibility. Specifically:</p>
<ol>
<li>It will (in it's current guise) only ever cause compiler warnings not errors. Obviously you can enable warnings as errors but this isn't always feasible on large legacy projects.</li>
<li>It must be specifically enabled at a project level - potentially a large undertaking on legacy projects - or via messy directives in code.</li>
<li>It can't be applied consistently in all cases or at all in some cases. For example Jon Skeet's IEqualityComparer<T> example <a href="https://codeblog.jonskeet.uk/2018/04/21/first-steps-with-nullable-reference-types/">here</a> or the &quot;Generics and nullable types&quot; section of <a href="https://www.infoq.com/articles/csharp-nullable-reference-case-study/">this InfoQ post</a>.</li>
<li>Mixing code using &quot;null reference types&quot; with class libraries which have not implemented this functionality is likely to be extremely messy in the short to medium term requiring &quot;nullable shims&quot; etc.</li>
<li>In the majority of cases, it doesn't actually remove the need for null reference checks.</li>
</ol>
<p>To me the &quot;Nullable reference types&quot; feature feels a bit like the proverbial hammer used to crack a nut. Except that, in this instance, the hammer isn't actually capable of cracking the nut, it is just a vehicle for the label on the side providing instructions on how to get the nut cracked.</p>
<p>Ok, that's a little facetious. On new or small code-bases, I'm sure utilizing &quot;nullable reference types&quot; will pay dividends and I would support it's use whole-heartedly. But what about large legacy code bases where having to specifically enable &quot;nullable reference types&quot; or enabling &quot;warnings as errors&quot; might not be viable.</p>
<h2 id="perhaps-theres-another-option">Perhaps there's another Option?</h2>
<p>The more astute readers out there have no doubt have seen where this blog post is heading due to my nod to F# above and the not so subtle use of the word Option. As a functional language, F# eschews the use of null (unless specifically enabled on a type by type basis) by explicitly modelling the concept of &quot;nothing-able&quot; with a type: the discriminated union type called Option.</p>
<p>Here's a description of the Option type from the <a href="https://docs.microsoft.com/en-us/dotnet/fsharp/language-reference/discriminated-unions">FSharp Language Reference</a>:</p>
<blockquote class="blockquote">
<p>The option type is a simple discriminated union in the F# core library. The option type is declared as follows.</p>
<pre><code class="language-F#">// The option type is a discriminated union.
type Option&lt;'a&gt; =
    | Some of 'a
    | None
</code></pre>
<p>The previous code specifies that the type Option is a discriminated union that has two cases, Some and None. The Some case has an associated value that consists of one anonymous field whose type is represented by the type parameter 'a. The None case has no associated value. Thus the option type specifies a generic type that either has a value of some type or no value.</p>
</blockquote>
<p>In short, instead of allowing a value to be null, the value is wrapped inside another object which is able to explicitly say whether the value is something or nothing. While this is an F# concept, it can be mirrored quite simply in C# as follows:</p>
<pre><code class="language-C#">public struct Option&lt;T&gt;
{
    public static readonly Option&lt;T&gt; None = new Option&lt;T&gt;();

    public static Option&lt;T&gt; Some(T value)
    {
        return new Option&lt;T&gt;(value);
    }

    private Option(T value)
    {
        IsSome = true;
        Value = value;
    }

    public T Value { get; private set; }
    public bool IsSome { get; private set; }
    public bool IsNone =&gt; !IsSome;
}
</code></pre>
<p>Note that this is a struct (i.e. a value type which cannot be null) but also generic meaning it can hold a reference type value. Using this class we can write code which in which we can be confident that we won't encounter a null reference:</p>
<pre><code class="language-C#">var option = GetSomeOption();
if (option.IsSome)
{
    Console.WriteLine($&quot;Found a value of {option.Value}&quot;);
}
else
{
    Console.WriteLine(&quot;Did not find a value&quot;);
}
</code></pre>
<p>What's that? This code looks exactly like the code for a null reference check? True, except for three important differences:</p>
<ol>
<li>The use of an Option as the return type indicates to the consumer that &quot;None&quot; is a valid value and must be considered - as opposed to a null which may or may not be deliberate.</li>
<li>The Value property must be explicitly read from the Option meaning the consumer is less likely to access the property without checking that it 'IsSome' first.</li>
<li>You can do more with <em>something</em> than you can with <em>nothing</em>; read on.</li>
</ol>
<p>Regarding that last point, once we have something - i.e. an Option type - we can work with it to facilitate it's use in code. For example, consider the following extension methods:</p>
<pre><code class="language-C#">/// &lt;summary&gt;
/// Projects an &lt;see cref=&quot;Option{T}&quot;/&gt; of &lt;typeparamref name=&quot;TSource&quot;/&gt; to
/// an &lt;see cref=&quot;Option{T}&quot;/&gt; of &lt;typeparamref name=&quot;TDest&quot;/&gt; using the
/// specified &lt;paramref name=&quot;projection&quot;/&gt;
/// &lt;/summary&gt;
public static Option&lt;TDest&gt; Select&lt;TSource, TDest&gt;(this Option&lt;TSource&gt; source, Func&lt;TSource, Option&lt;TDest&gt;&gt; projection)
{
    return source.IsSome ? projection(source.Value) : None&lt;TDest&gt;();
}

/// &lt;summary&gt;
/// If the &lt;see cref=&quot;Option{T}.IsSome&quot;/&gt; returns true for the &lt;see cref=&quot;Option{T}&quot;/&gt; specified in &lt;paramref name=&quot;source&quot;/&gt;
/// then this method will return it's &lt;see cref=&quot;Option{T}.Value&quot;/&gt;, otherwise the value of the &lt;paramref name=&quot;value&quot;/&gt; parameter
/// is returned
/// &lt;/summary&gt;
public static T Coalesce&lt;T&gt;(this Option&lt;T&gt; source, T value)
{
    return source.IsSome ? source.Value : value;
}
</code></pre>
<p>Using these we can move away from imperative property checking an adopt a more declarative style:</p>
<pre><code class="language-C#">var response = GetSomeOption()
    .Select(value =&gt; $&quot;Found a value of {value}&quot;)
    .Coalesce(&quot;Did not find a value&quot;);

Console.WriteLine(response);
</code></pre>
<p>The benefits of declarative code vs imperative code will likely be the subject of my next &quot;contentious&quot; blog post. I have repeatedly debated  the various pros and cons of declarative code with co-workers and clients and still believe it's a fundamentally better way of expressing intent while simultaneously and writing &quot;safer&quot; code.</p>
<p>So anyway, notice anything about the Option type?</p>
<h2 id="oh-isnt-this-one-of-those.err.gonad-things">Oh, isn't this one of those... err... gonad things?</h2>
<p>Monad? Yes. The Option type is, in my opinion, the quintessential monad as, when combined with compositional functions like those shown above, it is able to provide &quot;a design pattern that allows structuring programs generically while automating away boilerplate code needed by the program logic&quot;; i.e. removing all those damn ugly null checks!</p>
<p>After working with the Option type for a number of years across numerous project's I've accumulated (mostly by plagiarizing F#) a number of monadic functions which can almost eliminate imperative code (at least with respect to null checking). These functions are especially useful for collections as shown (in the somewhat contrived example) below:</p>
<pre><code class="language-C#">var result = Enumerable
    .Range(1, 100)
    .Select(value =&gt; ReturnSomeIfAValidValueOtherwiseNone(value)) // &lt;= Returns an Option
    .Collect() // &lt;= Do not propagate values of Option.None
    .FirstOption() // &lt;= Take the first value of Option.Some or return Option.None if none exist
    .Select(value =&gt; $&quot;{value} is the first valid value&quot;)
    .Coalesce(&quot;No valid values found&quot;);
</code></pre>
<h2 id="ok-so-where-does-this-get-us">Ok, so where does this get us?</h2>
<p>Well, looking back and comparing this with &quot;nullable reference types&quot;, I believe explicitly modelling the concept of nothing using the Option type provides many advantages such as:</p>
<ol>
<li>You can adopt this approach incrementally - one method at a time if need be - without huge numbers of warnings or messy code directives.</li>
<li>Explicitly stating that a method can return &quot;nothing&quot; with the Option type is a much more obvious means of expressing intent than a &quot;nullable reference type&quot;.</li>
<li>You can finally get rid of null reference checks!</li>
<li>Returning <em>something</em> rather than <em>nothing</em> facilitates the adoption of a more declarative programming style.</li>
</ol>
<p>So there we go. A safe, obvious, easy and, most-importantly, low-cost means of dealing with the &quot;Billion-Dollar Mistake&quot;. Give it a stab and see what you think. As shown above, there's a very low barrier to entry so there's very little to lose.</p>



                                </div>
                        </div>
                </div>
                
                <hr>
                
                <!-- Footer -->
                <footer>
                        <div class="container">
        <div class="row">
                <div class="col-md-12">
                        <ul class="list-inline text-center">
    <li>
        <a href="https://twitter.com/ibebbs">
            <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
            </span>
        </a>
    </li>
    <li>
        <a href="https://www.linkedin.com/in/ianbebbington/">
            <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
            </span>
        </a>
    </li>
    <li />
    <li>
        <a href="https://github.com/ibebbs">
            <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
            </span>
        </a>
    </li>
    <li>
        <a href="https://stackoverflow.com/users/628821/ibebbs">
            <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-stack-overflow fa-stack-1x fa-inverse"></i>
            </span>
        </a>
    </li>
</ul>
                        <br />
                        <ul class="list-inline text-center">
                                <li>                                
                                        <!-- Buy Me A Coffee Button -->
                                        <style>.bmc-button img{width: 27px !important;margin-bottom: 1px !important;box-shadow: none !important;border: none !important;vertical-align: middle !important;}.bmc-button{line-height: 36px !important;height:37px !important;text-decoration: none !important;display:inline-flex !important;color:#FFFFFF !important;background-color:#FF813F !important;border-radius: 3px !important;border: 1px solid transparent !important;padding: 1px 9px !important;font-size: 22px !important;letter-spacing: 0.6px !important;box-shadow: 0px 1px 2px rgba(190, 190, 190, 0.5) !important;-webkit-box-shadow: 0px 1px 2px 2px rgba(190, 190, 190, 0.5) !important;margin: 0 auto !important;font-family:'Cookie', cursive !important;-webkit-box-sizing: border-box !important;box-sizing: border-box !important;-o-transition: 0.3s all linear !important;-webkit-transition: 0.3s all linear !important;-moz-transition: 0.3s all linear !important;-ms-transition: 0.3s all linear !important;transition: 0.3s all linear !important;}.bmc-button:hover, .bmc-button:active, .bmc-button:focus {-webkit-box-shadow: 0px 1px 2px 2px rgba(190, 190, 190, 0.5) !important;text-decoration: none !important;box-shadow: 0px 1px 2px 2px rgba(190, 190, 190, 0.5) !important;opacity: 0.85 !important;color:#FFFFFF !important;}</style><link href="https://fonts.googleapis.com/css?family=Cookie" rel="stylesheet"><a class="bmc-button" target="_blank" href="https://www.buymeacoffee.com/BQKYdkpaN"><img src="https://bmc-cdn.nyc3.digitaloceanspaces.com/BMC-button-images/BMC-btn-logo.svg" alt="Buy me a coffee"><span style="margin-left:5px">Buy me a coffee</span></a>
                                </li>
                        </ul>
                        <p class="copyright text-muted">
                                Copyright © 2019. The opinions expressed herein are my own and do not represent those of my employer or any other third-party views in any way. This work is licensed under a <a href="http://creativecommons.org/licenses/by/4.0/" rel="license">Creative Commons Attribution 4.0 International License</a>.
                                <br />
                                <a href="/feed.rss"><i class="fa fa-rss"></i> RSS Feed</a> | <a href="/feed.atom"><i class="fa fa-rss"></i> Atom Feed</a>
                                <br />
                                <strong><a href="https://wyam.io">Generated by Wyam</a></strong>
                                <br />
                        <br />
                        </p>
                </div>
        </div>
</div>
                </footer> 

                
                <script>hljs.initHighlightingOnLoad();</script>

                        <script type="text/javascript">                
                                // Header background                        
                                var colors = Please.make_color({
                                        colors_returned: 3,
                                        saturation: .6
                                });
                                var t = new Trianglify({
                                        x_gradient: colors,
                                        y_gradient: ["#FFFFFF"]
                                });
                                var header = document.getElementById("intro-header");
                                var pattern = t.generate(header.clientWidth, header.clientHeight);
                                header.setAttribute('style', 'background-image: ' + pattern.dataUrl);                        
                        </script>

                <script>
                        BackgroundCheck.init({
                                targets: '.intro-header,.navbar',
                                images: '.intro-header'
                        });
                </script>
        </body>
</html>

